<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Football Tournament Tickets ‚Äì QR Prototype</title>
  <!-- Libraries -->
  <script src="https://unpkg.com/html5-qrcode" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
  <style>
    :root{--bg:#0b1220;--card:#121a2b;--ink:#e8eefc;--muted:#9fb3d1;--accent:#6aa6ff;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:linear-gradient(180deg,#0b1220,#0a1020);color:var(--ink)}
    header{position:sticky;top:0;z-index:10;background:rgba(11,18,32,.8);backdrop-filter:blur(6px);border-bottom:1px solid #1f2a44}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:20px;letter-spacing:.2px}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tab{border:1px solid #223357;background:#0f1627;color:var(--ink);padding:10px 14px;border-radius:12px;cursor:pointer}
    .tab.active{background:var(--accent);border-color:transparent;color:#04122e}
    main{padding:16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .card{background:var(--card);border:1px solid #1d2942;border-radius:16px;padding:16px}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#0d1b33;border:1px solid #203055;color:var(--muted);font-size:12px}
    .btn{border:0;padding:10px 14px;border-radius:12px;background:#16233f;color:var(--ink);cursor:pointer}
    .btn.primary{background:var(--accent);color:#08132b}
    .btn.ok{background:var(--ok);color:#03150a}
    .btn.warn{background:var(--warn);color:#1a1304}
    .btn.err{background:var(--err);color:#2a0a0a}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #27395f;background:#0e1730;color:var(--ink)}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #1f2a44;text-align:left;font-size:14px}
    .qrbox{background:#0a1020;border:1px dashed #2a3b63;border-radius:12px;min-height:160px;display:flex;align-items:center;justify-content:center}
    .small{font-size:12px;color:var(--muted)}
    .footer{margin-top:24px;color:var(--muted);font-size:12px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    code.inline{background:#09122a;border:1px solid #1f2a44;padding:2px 6px;border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>üèüÔ∏è Football Tournament Ticketing ‚Äî QR Prototype</h1>
      <nav id="tabs"></nav>
    </div>
  </header>  <main class="wrap">
    <!-- Tabs Content --><!-- Scan -->
<section id="tab-scan" class="tabview">
  <div class="grid">
    <div class="card">
      <h2>üîç Scan Event QR</h2>
      <p class="small">Tip: Most mobile browsers require <b>HTTPS</b> to access the camera. If camera fails, load this file via a local server or deploy to an HTTPS host.</p>
      <div id="reader" class="qrbox" style="min-height:260px"></div>
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="btnStartScan">Start Scanner</button>
        <button class="btn warn" id="btnStopScan" disabled>Stop Scanner</button>
      </div>
    </div>
    <div class="card">
      <h2>üß™ Generate Sample Event QR</h2>
      <p class="small">This creates a QR for demo event <code class="inline">E1001</code>. You can print or show it on another screen and scan it.</p>
      <div style="display:grid;gap:10px;grid-template-columns:1fr 1fr">
        <div>
          <label>QR Payload Type</label>
          <select id="qrType">
            <option value="url">URL (?eventId=E1001)</option>
            <option value="json">JSON ({eventId:"E1001"})</option>
          </select>
        </div>
        <div>
          <label>Event ID</label>
          <input id="qrEventId" value="E1001" />
        </div>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn primary" id="btnMakeDemoQR">Make QR</button>
        <button class="btn" id="btnClearDemoQR">Clear</button>
      </div>
      <div id="demoQr" class="qrbox" style="margin-top:12px"></div>
      <p class="small">Payload preview: <span id="qrPreview" class="pill"></span></p>
    </div>
  </div>
</section>

<!-- Event Info -->
<section id="tab-event" class="tabview" style="display:none">
  <div class="card">
    <h2>üìÖ Event Information</h2>
    <div id="eventInfo">Scan a QR to load an event‚Ä¶</div>
  </div>
</section>

<!-- Booking -->
<section id="tab-book" class="tabview" style="display:none">
  <div class="grid">
    <div class="card">
      <h2>üéüÔ∏è Book Tickets</h2>
      <div id="bookForm">Load an event first.</div>
    </div>
    <div class="card">
      <h2>üßæ Generated Ticket</h2>
      <div id="ticketArea">
        <p class="small">After a successful payment simulation, your ticket QR will appear here.</p>
        <div id="ticketQr" class="qrbox"></div>
        <div id="ticketMeta" style="margin-top:10px"></div>
      </div>
    </div>
  </div>
</section>

<!-- My Tickets -->
<section id="tab-mine" class="tabview" style="display:none">
  <div class="card">
    <h2>üìÇ My Tickets</h2>
    <div id="myTickets"></div>
  </div>
</section>

<!-- Admin -->
<section id="tab-admin" class="tabview" style="display:none">
  <div class="grid">
    <div class="card">
      <h2>üõ†Ô∏è Add Demo Event (Local)</h2>
      <p class="small">Adds to <code class="inline">localStorage</code> for testing. Not secure; for prototype only.</p>
      <div style="display:grid;gap:10px">
        <div>
          <label>Tournament Name</label>
          <input id="aName" placeholder="Super Cup 2025" />
        </div>
        <div>
          <label>Event ID</label>
          <input id="aId" placeholder="E2001" />
        </div>
        <div>
          <label>Date & Time (ISO)</label>
          <input id="aDT" placeholder="2025-09-20T19:30:00" />
        </div>
        <div>
          <label>Venue</label>
          <input id="aVenue" placeholder="National Stadium" />
        </div>
        <div>
          <label>City</label>
          <input id="aCity" placeholder="Guwahati" />
        </div>
        <button class="btn primary" id="btnAddEvent">Add Event</button>
      </div>
    </div>
    <div class="card">
      <h2>ü§ñ FAQ Assistant (Demo)</h2>
      <div id="botArea">
        <div id="botLog" style="height:220px;overflow:auto;border:1px solid #203055;border-radius:12px;padding:10px;background:#0d1528"></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="botInput" placeholder="Ask about venue, time, tickets‚Ä¶" />
          <button class="btn" id="botSend">Ask</button>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="footer">Prototype only. Uses in-browser data & sandbox flows. Replace with secure backend, real payment gateway, and organizer-side scan/verify app for production.
</div>

  </main>  <script>
  // ------------------------------
  // Minimal in-memory + local data
  // ------------------------------
  const seedEvents = {
    "E1001": {
      tournamentName: "Assam Super Cup 2025",
      dateTime: "2025-10-15T18:00:00",
      venue: "Indira Gandhi Athletic Stadium",
      city: "Guwahati",
      matches: [
        { id: "M1", dateTime: "2025-10-15T18:00:00", teams: ["Brahmaputra FC","Kamakhya United"] },
        { id: "M2", dateTime: "2025-10-18T18:00:00", teams: ["Shillong Warriors","Tezpur Titans"] }
      ],
      teams: [
        { name: "Brahmaputra FC", players: [
          { name: "Rohan Das", age: 24, position: "FW", nationality: "India" },
          { name: "Imran Hussain", age: 28, position: "MF", nationality: "India" },
          { name: "Luis Ortega", age: 26, position: "DF", nationality: "Spain" }
        ]},
        { name: "Kamakhya United", players: [
          { name: "Tapan Deka", age: 27, position: "GK", nationality: "India" },
          { name: "Arjun Gogoi", age: 21, position: "DF", nationality: "India" },
          { name: "Kenji Mori", age: 25, position: "MF", nationality: "Japan" }
        ]}
      ],
      tickets: {
        VIP:    { price: 2500, available: 40 },
        Premium:{ price: 1200, available: 120 },
        Regular:{ price: 500,  available: 300 }
      }
    }
  };

  const store = {
    loadEvents(){
      const custom = JSON.parse(localStorage.getItem('events.custom')||'{}');
      return { ...seedEvents, ...custom };
    },
    saveCustomEvent(id, data){
      const custom = JSON.parse(localStorage.getItem('events.custom')||'{}');
      custom[id] = data; localStorage.setItem('events.custom', JSON.stringify(custom));
    },
    getTickets(){ return JSON.parse(localStorage.getItem('tickets')||'[]'); },
    saveTicket(t){ const all = store.getTickets(); all.push(t); localStorage.setItem('tickets', JSON.stringify(all)); },
  };

  let EVENTS = store.loadEvents();
  let currentEventId = null;
  let currentScan = null; // html5Qrcode instance

  // ------------------------------
  // UI Tabs
  // ------------------------------
  const tabs = [
    { id:'scan',  label:'Scan' },
    { id:'event', label:'Event' },
    { id:'book',  label:'Book' },
    { id:'mine',  label:'My Tickets' },
    { id:'admin', label:'Admin' },
  ];
  const tabsEl = document.getElementById('tabs');
  tabs.forEach(t=>{
    const b = document.createElement('button');
    b.className = 'tab'; b.id = `tabbtn-${t.id}`; b.textContent = t.label;
    b.onclick = ()=>showTab(t.id);
    tabsEl.appendChild(b);
  });
  function showTab(id){
    document.querySelectorAll('.tab').forEach(el=>el.classList.remove('active'));
    document.getElementById(`tabbtn-${id}`).classList.add('active');
    document.querySelectorAll('.tabview').forEach(s=>s.style.display='none');
    document.getElementById(`tab-${id}`).style.display='block';
    if(id==='mine') renderMyTickets();
  }
  showTab('scan');

  // ------------------------------
  // QR Demo Generator
  // ------------------------------
  let demoQr;
  function buildPayload(type, eventId){
    if(type==='json') return JSON.stringify({eventId});
    const url = new URL(window.location.href);
    url.searchParams.set('eventId', eventId);
    return url.toString();
  }
  document.getElementById('btnMakeDemoQR').onclick = ()=>{
    const type = document.getElementById('qrType').value;
    const eventId = document.getElementById('qrEventId').value.trim()||'E1001';
    const payload = buildPayload(type, eventId);
    document.getElementById('qrPreview').textContent = payload.slice(0,120)+(payload.length>120?'‚Ä¶':'');
    const box = document.getElementById('demoQr'); box.innerHTML='';
    demoQr = new QRCode(box, { text: payload, width: 220, height: 220 });
  };
  document.getElementById('btnClearDemoQR').onclick = ()=>{
    document.getElementById('demoQr').innerHTML='';
    document.getElementById('qrPreview').textContent='';
  };

  // ------------------------------
  // Scanner
  // ------------------------------
  async function startScanner(){
    const readerEl = document.getElementById('reader');
    readerEl.innerHTML='';
    const html5QrCode = new Html5Qrcode("reader");
    currentScan = html5QrCode;
    const config = { fps: 10, qrbox: { width: 250, height: 250 } };
    try{
      await html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess);
      document.getElementById('btnStartScan').disabled = true;
      document.getElementById('btnStopScan').disabled = false;
    }catch(e){ alert('Camera start failed: '+e); }
  }
  async function stopScanner(){
    if(currentScan){
      try{ await currentScan.stop(); }catch(e){}
      try{ await currentScan.clear(); }catch(e){}
      currentScan = null;
      document.getElementById('btnStartScan').disabled = false;
      document.getElementById('btnStopScan').disabled = true;
    }
  }
  document.getElementById('btnStartScan').onclick = startScanner;
  document.getElementById('btnStopScan').onclick = stopScanner;

  function parseEventIdFromPayload(text){
    try{
      // JSON payload
      const obj = JSON.parse(text);
      if(obj.eventId) return obj.eventId;
    }catch(e){ /* not json */ }
    try{
      // URL with ?eventId=
      const u = new URL(text);
      const id = u.searchParams.get('eventId');
      if(id) return id;
    }catch(e){ /* not url */ }
    // Plain eventId
    if(/^E\d+$/i.test(text.trim())) return text.trim();
    return null;
  }

  function onScanSuccess(decodedText){
    const id = parseEventIdFromPayload(decodedText);
    if(!id){ alert('No eventId found in QR.'); return; }
    stopScanner();
    loadEvent(id);
    showTab('event');
  }

  // ------------------------------
  // Event Load + Render
  // ------------------------------
  function loadEvent(id){
    EVENTS = store.loadEvents();
    const ev = EVENTS[id];
    if(!ev){
      document.getElementById('eventInfo').innerHTML = `<p class="pill">Event ${id} not found.</p>`;
      currentEventId = null;
      document.getElementById('bookForm').innerHTML = 'Load an event first.';
      return;
    }
    currentEventId = id;
    renderEvent(ev);
    renderBooking(ev);
  }

  function renderEvent(ev){
    const fmt = (iso)=> new Date(iso).toLocaleString();
    let html = '';
    html += `<div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px">
      <span class="pill">${ev.tournamentName}</span>
      <span class="pill">${fmt(ev.dateTime)}</span>
      <span class="pill">${ev.venue}, ${ev.city}</span>
    </div>`;

    html += `<h3>Matches</h3><table><thead><tr><th>ID</th><th>Date & Time</th><th>Teams</th></tr></thead><tbody>`;
    ev.matches.forEach(m=>{
      html += `<tr><td>${m.id}</td><td>${fmt(m.dateTime)}</td><td>${m.teams[0]} vs ${m.teams[1]}</td></tr>`;
    });
    html += `</tbody></table>`;

    html += `<h3 style="margin-top:16px">Teams & Players</h3>`;
    ev.teams.forEach(t=>{
      html += `<div class="card" style="margin:12px 0">
        <div style="display:flex;justify-content:space-between;align-items:center"><h4 style="margin:0">${t.name}</h4><span class="pill">Players: ${t.players.length}</span></div>
        <table style="margin-top:8px"><thead><tr><th>Name</th><th>Age</th><th>Position</th><th>Nationality</th></tr></thead><tbody>`;
      t.players.forEach(p=>{
        html += `<tr><td>${p.name}</td><td>${p.age}</td><td>${p.position}</td><td>${p.nationality}</td></tr>`;
      });
      html += `</tbody></table></div>`;
    });

    document.getElementById('eventInfo').innerHTML = html;
  }

  // ------------------------------
  // Booking
  // ------------------------------
  function renderBooking(ev){
    const tiers = Object.keys(ev.tickets);
    const form = `
      <div style="display:grid;gap:10px">
        <div>
          <label>Ticket Category</label>
          <select id="bkTier">
            ${tiers.map(k=>`<option value="${k}">${k} ‚Äî ‚Çπ${ev.tickets[k].price} (left: ${ev.tickets[k].available})</option>`).join('')}
          </select>
        </div>
        <div>
          <label>Quantity</label>
          <input id="bkQty" type="number" min="1" max="10" value="1" />
        </div>
        <div>
          <label>Full Name (for ticket)</label>
          <input id="bkName" placeholder="Your name" />
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn primary" id="bkPay">Proceed to Payment (Demo)</button>
          <button class="btn" id="bkRefresh">Refresh Availability</button>
        </div>
        <div id="bkMsg" class="small"></div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
          <button class="btn ok" id="bkSimSuccess">Simulate Success</button>
          <button class="btn err" id="bkSimFail">Simulate Fail</button>
        </div>
      </div>`;
    const host = document.getElementById('bookForm');
    host.innerHTML = form;

    document.getElementById('bkRefresh').onclick = ()=>loadEvent(currentEventId);
    document.getElementById('bkPay').onclick = ()=>{
      document.getElementById('bkMsg').textContent = 'Opening payment sandbox‚Ä¶ (use simulate buttons below)';
    };

    document.getElementById('bkSimSuccess').onclick = ()=>completeBooking(true);
    document.getElementById('bkSimFail').onclick = ()=>completeBooking(false);
  }

  function completeBooking(ok){
    const msg = document.getElementById('bkMsg');
    if(!ok){ msg.textContent = 'Payment failed. Please try again.'; return; }
    const ev = EVENTS[currentEventId];
    const tier = document.getElementById('bkTier').value;
    const qty = Math.max(1, parseInt(document.getElementById('bkQty').value||'1',10));
    const name = (document.getElementById('bkName').value||'Fan').trim();
    if(ev.tickets[tier].available < qty){ msg.textContent = 'Not enough tickets available.'; return; }

    // Deduct inventory (demo only ‚Äî not persistent to seed, but we keep in custom)
    ev.tickets[tier].available -= qty;
    // Mirror to custom store so refresh keeps value
    const custom = JSON.parse(localStorage.getItem('events.custom')||'{}');
    custom[currentEventId] = ev; localStorage.setItem('events.custom', JSON.stringify(custom));

    // Create ticket
    const ticketId = 'T'+Date.now()+Math.floor(Math.random()*1000);
    const ticket = { ticketId, eventId: currentEventId, tier, qty, holder: name, when: new Date().toISOString() };
    store.saveTicket(ticket);
    renderTicket(ticket);
    renderMyTickets();
    msg.textContent = 'Payment successful! Ticket generated below.';
  }

  function renderTicket(t){
    const payload = JSON.stringify({ ticketId: t.ticketId, eventId: t.eventId });
    const box = document.getElementById('ticketQr');
    box.innerHTML='';
    new QRCode(box, { text: payload, width: 220, height: 220 });
    document.getElementById('ticketMeta').innerHTML = `
      <div class="pill">Ticket: ${t.ticketId}</div>
      <div class="pill">Event: ${t.eventId}</div>
      <div class="pill">Tier: ${t.tier}</div>
      <div class="pill">Qty: ${t.qty}</div>
      <div class="pill">Name: ${t.holder}</div>
      <div class="pill">Booked: ${new Date(t.when).toLocaleString()}</div>`;
  }

  // ------------------------------
  // My Tickets
  // ------------------------------
  function renderMyTickets(){
    const list = store.getTickets().slice().reverse();
    if(!list.length){
      document.getElementById('myTickets').innerHTML = '<p class="small">No tickets yet.</p>';
      return;
    }
    let html = '<table><thead><tr><th>Ticket</th><th>Event</th><th>Tier</th><th>Qty</th><th>Holder</th><th>When</th><th>QR</th></tr></thead><tbody>';
    list.forEach(t=>{
      html += `<tr>
        <td>${t.ticketId}</td>
        <td>${t.eventId}</td>
        <td>${t.tier}</td>
        <td>${t.qty}</td>
        <td>${t.holder}</td>
        <td>${new Date(t.when).toLocaleString()}</td>
        <td><button class="btn" data-ticket='${JSON.stringify(t).replace(/'/g,"&apos;")}' onclick="showTicketQR(this)">Show</button></td>
      </tr>`;
    });
    html += '</tbody></table>';
    document.getElementById('myTickets').innerHTML = html;
  }
  window.showTicketQR = (btn)=>{
    const t = JSON.parse(btn.getAttribute('data-ticket'));
    showTab('book');
    renderTicket(t);
  };

  // ------------------------------
  // Admin (Add simple event)
  // ------------------------------
  document.getElementById('btnAddEvent').onclick = ()=>{
    const id = (document.getElementById('aId').value||'').trim();
    const data = {
      tournamentName: document.getElementById('aName').value||'Custom Cup',
      dateTime: document.getElementById('aDT').value||new Date(Date.now()+86400000).toISOString(),
      venue: document.getElementById